<% content_for :title, "Trade ##{@trade.id}" %>

<div class="mb-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold text-gray-900">Trade Details</h1>
    <div class="flex gap-2">
      <%= link_to "Create Another Trade", new_madmin_trade_path, class: "btn btn-primary" %>
      <%= link_to "Edit", edit_madmin_trade_path(@trade), class: "btn btn-secondary" %>
      <%= link_to "Back to Journal", madmin_trades_path, class: "btn btn-secondary" %>
      <%= link_to "Delete Trade",
            madmin_trade_path(@trade),
            data: {
              turbo_confirm: "Are you sure you want to delete this trade?",
              turbo_method: :delete
            },
            class: "btn btn-danger" %>
    </div>
  </div>
</div>

<div class="bg-white rounded-lg shadow">
  <div class="p-6">
    <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <dt class="text-sm font-medium text-gray-600">Trade Date</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @trade.trade_date.strftime("%B %d, %Y") %></dd>
      </div>

      <div>
        <dt class="text-sm font-medium text-gray-600">Account</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @trade.account.to_s %></dd>
      </div>

      <div>
        <dt class="text-sm font-medium text-gray-600">Symbol</dt>
        <dd class="mt-1 text-sm text-gray-900 font-mono"><%= @trade.symbol %></dd>
      </div>

      <div>
        <dt class="text-sm font-medium text-gray-600">Trade Type</dt>
        <dd class="mt-1 text-sm text-gray-900">
          <%= Trade::TRADE_TYPES[@trade.trade_type] || @trade.trade_type %>
        </dd>
      </div>

      <div>
        <dt class="text-sm font-medium text-gray-600">P&L</dt>
        <dd class="mt-1 text-sm font-mono font-semibold
          <%= @trade.pnl >= 0 ? "text-green-600" : "text-red-600" %>">
          <%= number_to_currency(@trade.pnl, precision: 2) %>
        </dd>
      </div>

      <div>
        <dt class="text-sm font-medium text-gray-600">Created At</dt>
        <dd class="mt-1 text-sm text-gray-900">
          <%= @trade.created_at.strftime("%B %d, %Y at %I:%M %p") %>
        </dd>
      </div>

      <div>
        <dt class="text-sm font-medium text-gray-600">Updated At</dt>
        <dd class="mt-1 text-sm text-gray-900">
          <%= @trade.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
        </dd>
      </div>

      <% if @trade.tags.any? %>
        <div class="md:col-span-2">
          <dt class="text-sm font-medium text-gray-600 mb-2">Tags</dt>
          <dd class="mt-1 flex flex-wrap gap-2">
            <% @trade.tags.each do |tag| %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm
                font-medium"
                style="background-color: <%= tag.color %>20; color: <%= tag.color %>;">
                <%= tag.name %>
              </span>
            <% end %>
          </dd>
        </div>
      <% end %>
    </dl>
  </div>

  <!-- Optional Fields Section -->
  <% if @trade.volume.present? || @trade.entry_price.present? || @trade.exit_price.present? ||
        @trade.stop_loss.present? || @trade.take_profit.present? || @trade.entry_time.present? ||
        @trade.exit_time.present? || @trade.commission.present? || @trade.swap.present? ||
        @trade.strategy.present? || @trade.market.present? || @trade.setup.present? ||
        @trade.emotional_state.present? || @trade.market_condition.present? ||
        @trade.trade_grade.present? || @trade.notes.present? || @trade.lesson_learned.present? %>
    <div class="border-t border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Additional Details</h2>
      <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <% if @trade.volume.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Quantity</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= number_with_precision(@trade.volume, precision: 2) %></dd>
          </div>
        <% end %>

        <% if @trade.entry_price.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Entry Price</dt>
            <dd class="mt-1 text-sm text-gray-900 font-mono"><%= number_with_precision(@trade.entry_price, precision: 5) %></dd>
          </div>
        <% end %>

        <% if @trade.exit_price.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Exit Price</dt>
            <dd class="mt-1 text-sm text-gray-900 font-mono"><%= number_with_precision(@trade.exit_price, precision: 5) %></dd>
          </div>
        <% end %>

        <% if @trade.stop_loss.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Stop Loss</dt>
            <dd class="mt-1 text-sm text-gray-900 font-mono"><%= number_with_precision(@trade.stop_loss, precision: 5) %></dd>
          </div>
        <% end %>

        <% if @trade.take_profit.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Take Profit</dt>
            <dd class="mt-1 text-sm text-gray-900 font-mono"><%= number_with_precision(@trade.take_profit, precision: 5) %></dd>
          </div>
        <% end %>

        <% if @trade.entry_time.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Entry Time</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @trade.entry_time.strftime("%B %d, %Y at %I:%M %p") %></dd>
          </div>
        <% end %>

        <% if @trade.exit_time.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Exit Time</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @trade.exit_time.strftime("%B %d, %Y at %I:%M %p") %></dd>
          </div>
        <% end %>

        <% if @trade.commission.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Commission</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= number_to_currency(@trade.commission, precision: 2) %></dd>
          </div>
        <% end %>

        <% if @trade.swap.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Swap</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= number_to_currency(@trade.swap, precision: 2) %></dd>
          </div>
        <% end %>

        <% if @trade.strategy.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Strategy</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @trade.strategy %></dd>
          </div>
        <% end %>

        <% if @trade.market.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Market</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @trade.market %></dd>
          </div>
        <% end %>

        <% if @trade.emotional_state.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Emotional State</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @trade.emotional_state %></dd>
          </div>
        <% end %>

        <% if @trade.market_condition.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Market Condition</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @trade.market_condition %></dd>
          </div>
        <% end %>

        <% if @trade.trade_grade.present? %>
          <div>
            <dt class="text-sm font-medium text-gray-600">Trade Grade</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @trade.trade_grade %></dd>
          </div>
        <% end %>

        <% if @trade.setup.present? %>
          <div class="md:col-span-2">
            <dt class="text-sm font-medium text-gray-600">Setup</dt>
            <dd class="mt-1 text-sm text-gray-900 whitespace-pre-wrap"><%= @trade.setup %></dd>
          </div>
        <% end %>

        <% if @trade.notes.present? %>
          <div class="md:col-span-2">
            <dt class="text-sm font-medium text-gray-600">Notes</dt>
            <dd class="mt-1 text-sm text-gray-900 whitespace-pre-wrap"><%= @trade.notes %></dd>
          </div>
        <% end %>

        <% if @trade.lesson_learned.present? %>
          <div class="md:col-span-2">
            <dt class="text-sm font-medium text-gray-600">Lesson Learned</dt>
            <dd class="mt-1 text-sm text-gray-900 whitespace-pre-wrap"><%= @trade.lesson_learned %></dd>
          </div>
        <% end %>
      </dl>
    </div>
  <% end %>
</div>
