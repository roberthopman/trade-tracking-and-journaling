<% content_for :title, "Edit Expense" %>

<div class="header">
  <h1>Edit Expense</h1>
</div>

<div class="bg-white rounded-lg shadow p-4">
  <%= form_with model: @record, url: madmin_expense_path(@record), method: :patch, local: true do |form| %>

    <% if @record.errors.any? %>
      <div class="bg-red-50 border border-red-200 text-red-800 rounded-md p-3 mb-4">
        <h3 class="font-medium text-sm mb-1"><%= pluralize(@record.errors.count, "error") %> prohibited this expense from being saved:</h3>
        <ul class="list-disc list-inside text-sm">
          <% @record.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div class="field">
        <%= form.label :title, class: "block text-xs font-medium text-gray-700 mb-1" %>
        <%= form.text_field :title,
              placeholder: "e.g., Netflix Subscription",
              required: true,
              class: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded " \
                     "focus:outline-none focus:ring-1 focus:ring-blue-500" %>
      </div>

      <div class="field">
        <%= form.label :amount, class: "block text-xs font-medium text-gray-700 mb-1" %>
        <%= form.number_field :amount,
              step: 0.01,
              min: 0,
              required: true,
              placeholder: "0.00",
              class: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded " \
                     "focus:outline-none focus:ring-1 focus:ring-blue-500" %>
      </div>

      <div class="field">
        <%= form.label :expense_date,
              "Date",
              class: "block text-xs font-medium text-gray-700 mb-1" %>
        <%= form.date_field :expense_date,
              required: true,
              class: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded " \
                     "focus:outline-none focus:ring-1 focus:ring-blue-500" %>
      </div>

      <div class="field">
        <%= form.label :recurrence_type, class: "block text-xs font-medium text-gray-700 mb-1" %>
        <%= form.select :recurrence_type,
              Expense::RECURRENCE_TYPES.map { |type| [type.titleize, type] },
              {},
              class: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded " \
                     "focus:outline-none focus:ring-1 focus:ring-blue-500" %>
      </div>

      <div class="field md:col-span-2"
        data-controller="tag-input"
        data-tag-input-tags-value="<%= @record.tags.pluck(:name).to_json %>"
        data-tag-input-available-value="<%= current_user.tags.joins(:expenses).distinct.pluck(:name).to_json %>">
        <%= form.label :tag_list, "Tags", class: "block text-xs font-medium text-gray-700 mb-2" %>
        <div class="flex flex-wrap gap-2 mb-2" data-tag-input-target="tagsList"></div>
        <div class="mb-2" data-tag-input-target="suggestions"></div>
        <input type="text"
               data-tag-input-target="input"
               data-action="keydown->tag-input#addTag"
               placeholder="Type a tag and press Enter or comma"
               autocomplete="off"
               class="w-full px-2 py-1.5 text-sm border border-gray-300 rounded
                 focus:outline-none focus:ring-1 focus:ring-blue-500">
        <input type="hidden"
          name="expense[tag_list]"
          data-tag-input-target="hiddenInput">
        <p class="text-xs text-gray-500 mt-1">
          Press Enter or comma to add a tag, or click an existing tag above
        </p>
      </div>

      <div class="field md:col-span-2">
        <%= form.label :description, class: "block text-xs font-medium text-gray-700 mb-1" %>
        <%= form.text_area :description,
              rows: 2,
              placeholder: "Optional notes",
              class: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded " \
                     "focus:outline-none focus:ring-1 focus:ring-blue-500" %>
      </div>
    </div>

    <div class="flex items-center justify-end space-x-2 pt-3 border-t border-gray-200 mt-3">
      <%= link_to "Cancel", madmin_expense_path(@record), class: "btn btn-secondary" %>
      <%= form.submit "Update Expense", class: "btn btn-primary" %>
    </div>

  <% end %>
</div>
